<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="../stylesheets/style.css" rel="stylesheet">
  <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">
  <link href="/fontawesome/css/all.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
  <script src="/jquery-3.6.1.min.js"></script>

  <title>JQUERY</title>
</head>

<body class="body">
  <div class="container sm ">
    <div class="card h">
      <div class="h " style="height: 100px;">

        <div class=" text-center ">
          <h1>
            BREADS
          </h1>

          <h2>
            (Browse, Read, Edit, Add, Delete, Sort)
          </h2>
        </div>
      </div>

      <div class="card-body b">
        <table class="table table-striped">
          <tr class="c">
            <th class="c">
              <div class="card-header text-center c">
                <h2>ADD / EDIT Data</h2>
              </div>

              <div class="card-body c ">
                <div>
                  <form id="form-data-search" class="form">

                    <div class="row mb-3">
                      <label for="string" class="col-sm-2 col-form-check-label ">String</label>
                      <div class="col-sm-10">
                        <input type="text" id="s-string" class="form-control" name="string" placeholder="String">
                      </div>
                    </div>

                    <div class="row mb-3">


                      <label for="integer" class="col-sm-2 col-form-check-label ">Integer</label>
                      <div class="col-sm-10">
                        <input type="number" id="s-integer" class="form-control" name="integer" placeholder="Integer">
                      </div>
                    </div>

                    <div class="row mb-3">

                      <label for="float" class="col-sm-2 col-form-check-label ">Float</label>
                      <div class="col-sm-10">
                        <input type="number" id="s-float" class="form-control" name="float" placeholder="Float"
                          step="0.005">
                      </div>
                    </div>

                    <div class="row mb-3">

                      <label for="date" class="col-sm-2 col-form-check-label ">Date</label>
                      <div class="col-sm-4">
                        <input type="date" id="s-date" class="form-control" name="date" placeholder="Date" value='date'
                          required>
                      </div>
                    </div>

                    <div class="row mb-3">

                      <label for="boolean" class="col-sm-2 col-form-check-label ">boolean</label>
                      <div class="col-sm-10">
                        <select id="s-boolean" name="boolean" class="form-select" required>
                          <option value="" disabled selected>Choose boolean...</option>
                          <option value=True>True</option>
                          <option value=False>False</option>
                        </select>
                      </div>
                    </div>
                    <br>
                    <br>
                    <br>

                </div>
                <div class="card-footer ">
                  <button type="submit" class="btn btn-primary fa-solid fa-file-arrow-down" title="SAVE DATA">
                    Search</button>
                  <button class="btn btn-warning" type="submit" onclick="readData()"><i
                      class="fa-sharp fa-solid fa-rotate-left" title="Reset"> Reset </i></button>

                </div>
                <br>
                </form>
              </div>
            </th>

            <th>
              <div class="card-header text-center c">
                <h2>
                  SEARCH
                </h2>
              </div>
              <div class="card-body c">
                <form id="form-search">
                  <div class="row mb-3">
                    <label for="searchString" class="col-sm-2 col-form-check-label ">String</label>
                    <div class="col-sm-10">
                      <input type="text" class="form-control" id="searchString" name="searchString"
                        placeholder="String">
                    </div>
                  </div>

                  <div class="row mb-3">


                    <label for="searchInteger" class="col-sm-2 col-form-check-label ">Integer</label>
                    <div class="col-sm-10">
                      <input type="number" class="form-control" id="searchInteger" name="searchInteger"
                        placeholder="Integer">
                    </div>
                  </div>

                  <div class="row mb-3">

                    <label for="searchFloat" class="col-sm-2 col-form-check-label ">Float</label>
                    <div class="col-sm-10">
                      <input type="number" class="form-control" id="searchFloat" name="searchFloat" placeholder="Float"
                        step="0.005">
                    </div>
                  </div>

                  <div class="row mb-3">

                    <label for="searchDate" class="col-sm-2 col-form-check-label " id="searchDate">Date</label>
                    <div class="col-sm-4">
                      <input type="date" class="form-control" id="searchStartDate" name="searchStartDate"
                        placeholder="Date">
                      <label class=" col-form-label">to</label>
                      <input type="date" class="form-control" id="searchEndDate" name="searchEndDate"
                        placeholder="Date">
                    </div>
                  </div>

                  <div class="row mb-3">

                    <label for="searchBoolean" class="col-sm-2 col-form-check-label ">boolean</label>
                    <div class="col-sm-10">
                      <select id="searchBoolean" name="searchBoolean" class="form-select">
                        <option value="" selected> Choose Boolean ... </option>
                        <option value=True>True</option>
                        <option value=False>False</option>
                      </select>
                    </div>
                  </div>

                  <div class="d-grid gap-2 d-md-block card-footer">
                    <button class="btn btn-primary " type="submit"><i class="fa-solid fa-magnifying-glass"
                        title="Search"> Search</i></button>
                    <button class="btn btn-warning" onclick="resetData()"><i class="fa-sharp fa-solid fa-rotate-left"
                        title="Reset"> Reset </i></button>
                  </div>

                  <br>
                </form>
              </div>
            </th>

          </tr>
        </table>
        <div class="card-header text-center ">
          <h3><strong>RESULT</strong></h3>
        </div>
        <table id="table-data" class="table table-sortable   table-striped card-body ">
          <thead class="thead">
            <tr>
              <th>No</th>
              <th><i class="fa-solid fa-arrow-up-short-wide"></i></i>String</th>
              <th><i class="fa-solid fa-arrow-up-short-wide"></i></i>Integer</th>
              <th><i class="fa-solid fa-arrow-up-short-wide"></i></i>Float</th>
              <th><i class="fa-solid fa-arrow-up-short-wide"></i></i>Date</th>
              <th><i class="fa-solid fa-arrow-up-short-wide"></i></i>Boolean</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
        <div class="card-footer">
          <button type="button" class="btn btn-primary" onclick="$('#modal-form').modal('show')"">
            Add
          </button>
          <div class="row">
            <div class="col-md-10">
              <nav aria-label="Page navigation example" id="pagination">
              </nav>

            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="modal-form" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <form id="form-data" class="form">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Form</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                  onclick="$('#modal-form').modal('hide')">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">


                <div class="row mb-3">
                  <label for="string" class="col-sm-2 col-form-check-label ">String</label>
                  <div class="col-sm-10">
                    <input type="text" id="string" class="form-control" name="string" placeholder="String">
                  </div>
                </div>

                <div class="row mb-3">


                  <label for="integer" class="col-sm-2 col-form-check-label ">Integer</label>
                  <div class="col-sm-10">
                    <input type="number" id="integer" class="form-control" name="integer" placeholder="Integer">
                  </div>
                </div>

                <div class="row mb-3">

                  <label for="float" class="col-sm-2 col-form-check-label ">Float</label>
                  <div class="col-sm-10">
                    <input type="number" id="float" class="form-control" name="float" placeholder="Float" step="0.005">
                  </div>
                </div>

                <div class="row mb-3">

                  <label for="date" class="col-sm-2 col-form-check-label ">Date</label>
                  <div class="col-sm-4">
                    <input type="date" id="date" class="form-control" name="date" placeholder="Date" value='date'
                      required>
                  </div>
                </div>

                <div class="row mb-3">

                  <label for="boolean" class="col-sm-2 col-form-check-label ">boolean</label>
                  <div class="col-sm-10">
                    <select id="boolean" name="boolean" class="form-select" required>
                      <option value="" disabled selected>Choose boolean...</option>
                      <option value=True>True</option>
                      <option value=False>False</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <butto type="submit" class="btn btn-primary fa-solid fa-file-arrow-down">Save</button>
                  <button type="button" class="btn btn-secondary" data-dismiss="modal"
                    onclick="$('#modal-form').modal('hide')">Cancel</button>
              </div>
            </div>

          </form>
        </div>

      </div>

    </div>

  </div>

  <div class="modal fade" id="modal-delete" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Delete confirmation</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"
            onclick="$('#modal-delete').modal('hide')">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Are you sure to Delete this data?</p>
        </div>
        <div class="modal-footer">
          <button id="btn-deleted" type="button" class="btn btn-primary">Yes</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal"
            onclick="$('#modal-delete').modal('hide')">No</button>
        </div>
      </div>
    </div>
  </div>

  <script>

    let idEdit = null;
    let params = {
      display: 5,
      page: 1
    }
    $(document).ready(function () {
      readData()
      $('#form-data').submit(function (event) {
        event.preventDefault()
        saveData()
      })
      $('#table-data').on('click', '.btn-delete', function () {
        idDeleted = $(this).attr('dataid')
        $('#modal-delete').modal('show')

      })

      $('#btn-deleted').click(function () {
        removeData(idDeleted)
        $('#modal-delete').modal('hide')
        idDeleted = null;

      })


    })
    const readData = () => {
      $.ajax({
        //  method: "GET",  //huruf kecil or huruf besar tak masaleuhh
        url: "/users",
        dataType: "json", //mastiin yg masuk data jd json
        data: params
      }).done((response) => {
        let html = ''
        response.data.forEach((item, index) => {
          html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${item.string}</td>
                            <td>${item.integer}</td>
                            <td>${item.float}</td>
                            <td>${moment(item.date).format('DD/MMM/YYYY')}</td>
                            <td>${item.boolean}</td>
                            <td>
                                <div class="d-grid gap-2 d-md-block">
                                  <button type="button" class="btn btn-success btn-edit" title="Edit" onclick='editData(${JSON.stringify(item)}'><i
                                    class="fa-solid fa-pencil"></i></button>
                                  <button type="button" class="btn btn-danger btn-delete" title="Delete" dataid="${item._id}"><i
                                    class="fa-solid fa-trash-can" ></i></button>
                                      
                                    </a>
                                </div>
                            </td>  
                        </tr>
                        `
        })
        $('#table-data tbody').html(html)
        pagination()
      }).fail((err) => {
        {
          alert('gagal baca data jquery')
        }
      })
    }



    const saveData = () => {
      const string = $('#string').val()
      const integer = $('#integer').val()
      const float = $('#float').val()
      const date = $('#date').val()
      const boolean = $('#boolean').val()


      if (idEdit == null) {
        $.ajax({
          method: "POST",
          url: `/users`,
          dataType: "json",
          data: { string, integer, float, date, boolean }
        }).done((response) => {
          readData()
          $('#body-table').trigger("reset")
        }).fail((err) => {
          alert('gagal add data jquery')
        })
      } else {
        $.ajax({
          method: "PUT",
          url: `/users/${idEdit}`,
          dataType: "json",
          data: { string, integer, float, date, boolean },
        }).done((response) => {
          readData()
        }).fail((err) => {
          alert('gagal edit data jquery')
        })
        idEdit = null;
      }
      $('#string').val('')
      $('#integer').val('')
      $('#float').val('')
      $('#date').val('')
      $('#boolean').val('')
    }
    const removeData = (id) => {
      $.ajax({
        method: "DELETE",
        url: `/users/${id}`,
        dataType: "json",
      }).done((data) => {
        readData()
      }).fail((err) => {
        alert('gagal delete data jquery')
      })
    }

    const editData = (data) => {
      idEdit = data._id
      $('#string').val(data.string)
      $('#integer').val(data.integer)
      $('#float').val(data.float)
      $('#date').val(moment(data.date).format("YYYY-MM-DD"))
      $('#boolean').val(data.boolean)

    }
    const pagination = () => {
      let pagination = `<ul class="pagination">
                <li class="page-item${params.page == 1 ? ' disabled' : ''}">
                  <a class="page-link" id="halaman" href="javascripts:void(0)" onclick="changePage(${parseInt(params.page) - 1})" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                  </a>
                </li>`
      for (let i = 1; i <= params.totalPages; i++) {
        pagination += ` 
        <li class="page-item${i == params.page ? ' active' : ''}"><a class="page-link" id="halaman" href="javascript:void(0)" id="angka" onclick="changePage(${i})">${i}</a></li>`
      }
      pagination += `<li class="page-item${params.page == params.totalPages ? ' disabled' : ''}">  
              <a class="page-link" href="javascript:void(0)" onclick="changePage(${parseInt(params.page) + 1})" id="halaman" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
              </a>
        </li>
        
        </ul>`
      $('#pagination').html(pagination)
    }
    // console.log(params.page)
    // function changePage(page) {
    //   params = { ...params, page }
    //   console.log(params)
    //   readData()
    //   return false
    // }

    function resetData() {
      document.getElementById('form-search').reset()
      readData()

    }



    $(document).ready(() => {
      readData()

      $('#form-search').submit, ((event) => {
        event.preventDefault()
        const page = 1
        const string = $('#searchString').val()
        const integer = $('#searchInteger').val()
        const float = $('#searchFloat').val()
        const startDate = $('#searchStartDate').val()
        const endDate = $('#searchEndDate').val()
        const boolean = $('#searchBoolean').val()
        params = { ...params, string, integer, float, startDate, endDate, boolean, page }
        readData()
      })
      $('table tbody').on('click', '.btn-edit', function () {
        const id = $(this).attr('iddata')
        editData(id)

      })
      $('table body').on('click', '.btn-delete', function () {
        const id = $(this).attr('iddata')
        removeData(id)

      })
      readData()
    })
  </script>
</body>

</html>